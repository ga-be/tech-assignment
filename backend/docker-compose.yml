version: '3.1'
services:
  API:
    image: 'technical-assignment-docker.jar'
    ports:
      - "8080:8080"
    depends_on:
      PostgreSQL:
        condition: service_healthy
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://PostgreSQL:5432/images
      - SPRING_DATASOURCE_USERNAME=postgres
      - SPRING_DATASOURCE_PASSWORD=dbtestas
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
      - spring.servlet.multipart.max-file-size=8MB
      - spring.servlet.multipart.max-request-size=8MB
      - spring.cloud.gcp.credentials.encoded_key=ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZ29sZGVuLXBhc3NrZXktMzI3NDE1IiwKICAicHJpdmF0ZV9rZXlfaWQiOiAiYmRjNjM5NDNlZmVkYjhiMDJlODExNDJhYTVlOWVlYmJiNzBkNzEwMSIsCiAgInByaXZhdGVfa2V5IjogIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxuTUlJRXZRSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS2N3Z2dTakFnRUFBb0lCQVFDcDdEOTZVWjBCR0NNZFxuMjlJQUltUkd3ZC9qeGMrbE4wMEdxSWhsSENJd0M3d3lzeWV1TUNIdlZxUTBrdVN6YWFVODlPZkRNUXZxQmY3c1xuRzZTRzdPOUMyeTc3UkswRHd6dFRyNDNJampOSDl0YmFTa3JKNjIzYkxBL2FwZWlPRTJyNGRoMnk0czlBQ2NiVlxuQ1RCOGNDbUNQWmVQV0dJTlplOXJoNjdTSGtEaEVwZjZZTW8zWU5uanJ5OERmYnhmdW5yNXdXRTlWMlQ2VnRvTVxucXNLVXoySUhvM21wRnh1RldzMjZnMGp0dmFmQkJzc2IvY0RsYjRaYit5N3h2cDVGT2oyRStEcCtyb0VJa0pXSFxuelZhWVBiUjR4UTBUeFVzYkFGQnRnREgzRVVoQjJwMzNob3B4eFRmSHZtOGlrRnZiNm5nZjI0ZHlENjI5WW1odVxuTytpaFRVc3RBZ01CQUFFQ2dnRUFBdlJZSURUV0VZUk5iQUg3ODBPbDBiTWlSUEFXRGEzWitZRXBxZlJreGNnV1xuZEIwNFZlZUJWNHQrbkdsbmI1VXBLZGVxUmZNTzNYbFFOdU8rSnhoc2lwR01EaE5pSEx3aXhuQTVlMkM1bElrK1xuc0JuMWxmQXhmMHVUVlA1b2ZqdnBNcnUvQlhLN0hzWnN2aHlFU3MyYWN5akYvMWlPaitRVFZ4L0xVdHp5ek5jQ1xuS1AySWI1V0VMTndBRUpNWWxuMnVYeW9PaXlQekFldWNBbDlJUWY1L1RsSkx6Qlhrb1p1QVZQbkJSRnB5LzQzTlxuYk9YeWZnejlrUENsbG0xNm91WVF2Rmtvc3hSTEVNMkR1djdDSXJOVkpIZjh6L0FjMWkvV3pnYnlKNXJqRDVwaFxuSXhYRW9pMEdvYnBpREVqbGRndHh3VmM0RThSU0Q0MU1maFAzVTdONzRRS0JnUURjT0srQWJIUEJyRmhOMGFCSVxuRFdFWDgrajNHWVRLc1BiMGpDTlF5ZXp1UkJLUTBpdUg1ZThDRTQvWFV6VE9LcXFyU0Jhblk4QzF2OEk3d3BxVFxuK3FjKzRzVTlLZ0VBVWdVU2I5cmNVQzBBVWIzRnIyc0lZWHRxNC9ibGVrZm5NV29NUFlSL2pMTjV3b2ZPN0REaVxuNllUb0gwM2VOTm9GaHVvcXZGNUlVZEI5Y1FLQmdRREZoNU1XaXo3c3hiditZajQvRHNkR3dCckJRNEJZQ281TlxuK1JzaEU5ZDlJTWJwNEltd1JFcXIrdlJKczhLZTgwMHdhRkc1c0ljL201enEydURhUGRYcHduWW04NkJUM3pDOVxuODhlSnl0TVI0VnJLREdwREcxR3RFTG1zRVoxTyt6a0dPSU5KQnA3Q2ROMjE5M3NNNWcvSmtEcXE3VjJ2YmplSFxuYVRLUnE0YzdmUUtCZ1FDMURyM3NQajVseTBiR3BFUzlPSkxOV0xIL0JySVEyN0lPbVhFbnFQenRZSFpMTHlDdlxuR0xLSzZINW9zSFpIMHZpQzNrQVIyNGZEWmlkUmJzd2NRZ1pqUTVxYWtRQkZ2U21DWVFoMS9rMGhhQk00aHVMZVxuL3hhemFUM0NxZWlZQWg2SWRjT01BcWhFd1ZWYklRR0liaW5obG1zMCtBc1FaRDMrYU9TelhPQ25ZUUtCZ0I4MVxueTZ6Tk5aVU5yU1dGZWxaV1RIQkdYRFBiS1lVL3JicHVPTFlpUDNNYTRiTUVjbHp5ZldYdEVmb3ZOL29MY1UvTFxudTlYK0tYQ0ljdU84ejdoTCt1ZWpmUzJzWXRHOXV5TFlTTmZodnpYZENJNVNKZHdTamZZdFpWamxzNWhPSTNWelxuS25NNFk0OVFEZFA1bFd5MVVSdEUrYkFXTHk1UDJPQkJZK2NXVmhpMUFvR0FPaVZBaFJwYjNaNzNoeXhhTElKSlxubHRxVzlDb25aZU1yd3l3ZU5MeGxnTU1kYzhvQ0lLSjJGNHRHUGFIR1hiQkR3a3NaMnVpb0E4bTNRVzVPYW9mZlxudXdZMnVYVDZaVDI0VElIQTNVMEl0Z2hTcjllWTlwYVMzOCtYMys0cGZJbjFhTjlDcWZkQVNrOURqWGROdVlzWFxubDE5YjB2L0xadEdacHYzdXRSb0xFUEk9XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICJjbGllbnRfZW1haWwiOiAidmlzaW9uYXBpdGVzdEBnb2xkZW4tcGFzc2tleS0zMjc0MTUuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTAwOTI3MDA3NDMxOTk1MDcyMzQ4IiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS92aXNpb25hcGl0ZXN0JTQwZ29sZGVuLXBhc3NrZXktMzI3NDE1LmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==

  PostgreSQL:
    image: postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=dbtestas
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5